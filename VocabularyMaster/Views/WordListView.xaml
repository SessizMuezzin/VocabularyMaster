<UserControl x:Class="VocabularyMaster.WPF.Views.WordListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converters="clr-namespace:VocabularyMaster.WPF.Converters">
    <UserControl.Resources>
        <converters:FavoriteIconConverter x:Key="FavoriteIconConverter"/>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <converters:SelectedWordBorderConverter x:Key="SelectedWordBorderConverter"/>
        <converters:SelectedWordThicknessConverter x:Key="SelectedWordThicknessConverter"/>

        <!-- Rounded Button Style -->
        <Style x:Key="RoundedButtonStyle" TargetType="Button">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
    </UserControl.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Margin="0,0,0,25">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0">
                <TextBlock Text="📚 Kelime Koleksiyonum" FontSize="28" FontWeight="Bold" Foreground="#2c3e50"/>
                <TextBlock Text="Tüm kelimelerinizi buradan yönetin" FontSize="14" Foreground="#7f8c8d" Margin="0,5,0,0"/>
            </StackPanel>

            <Button Grid.Column="1" Content="➕ Yeni Kelime" Command="{Binding AddWordCommand}"
                    Height="45" Padding="20,0"
                    Background="#4CAF50" Foreground="White" FontSize="15" FontWeight="Bold"
                    BorderThickness="0" VerticalAlignment="Center"
                    Style="{StaticResource RoundedButtonStyle}"/>
        </Grid>

        <!-- Filters Bar -->
        <Border Grid.Row="1" Background="#f8f9fa" CornerRadius="10" Padding="20,15" Margin="0,0,0,20">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="15"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Üst Satır - Arama ve Filtreler -->
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="15"/>
                        <ColumnDefinition Width="200"/>
                        <ColumnDefinition Width="15"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Arama -->
                    <Border Grid.Column="0" Background="White" CornerRadius="8" BorderBrush="#ddd" BorderThickness="2">
                        <TextBox Padding="12,10" BorderThickness="0" FontSize="14"
                                 Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.Style>
                                <Style TargetType="TextBox">
                                    <Setter Property="Foreground" Value="Black"/>
                                    <Style.Triggers>
                                        <Trigger Property="Text" Value="">
                                            <Setter Property="Background">
                                                <Setter.Value>
                                                    <VisualBrush Stretch="None" AlignmentX="Left">
                                                        <VisualBrush.Visual>
                                                            <TextBlock Text="🔍 Kelime, anlam veya örnek cümlede ara..." 
                                                                       Foreground="#95a5a6" Margin="12,0,0,0" FontSize="14"/>
                                                        </VisualBrush.Visual>
                                                    </VisualBrush>
                                                </Setter.Value>
                                            </Setter>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBox.Style>
                        </TextBox>
                    </Border>

                    <!-- Kategori -->
                    <Border Grid.Column="2" Background="White" CornerRadius="8" BorderBrush="#ddd" BorderThickness="2">
                        <ComboBox Padding="12,10" BorderThickness="0" FontSize="14"
                                  ItemsSource="{Binding Categories}"
                                  SelectedItem="{Binding SelectedCategory}"
                                  SelectedIndex="0"/>
                    </Border>

                    <!-- Sadece Favoriler -->
                    <Border Grid.Column="4" Background="White" BorderBrush="#FF9800" BorderThickness="2" 
                            CornerRadius="8" Padding="15,10">
                        <CheckBox Content="⭐ Sadece Favoriler" 
                                  IsChecked="{Binding ShowOnlyFavorites}"
                                  FontSize="14" FontWeight="SemiBold"
                                  Foreground="#E65100" VerticalAlignment="Center"/>
                    </Border>
                </Grid>

                <!-- Alt Satır - Aksiyon Butonları -->
                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Command="{Binding ToggleFavoriteCommand}"
                            Height="38" Padding="15,0" Margin="0,0,10,0"
                            Background="#FF9800" Foreground="White" FontWeight="SemiBold"
                            BorderThickness="0"
                            Style="{StaticResource RoundedButtonStyle}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="⭐" FontSize="16" Margin="0,0,5,0"/>
                            <TextBlock Text="Favori" FontSize="13"/>
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding EditWordCommand}"
                            Height="38" Padding="15,0" Margin="0,0,10,0"
                            Background="#2196F3" Foreground="White" FontWeight="SemiBold"
                            BorderThickness="0"
                            Style="{StaticResource RoundedButtonStyle}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="✏️" FontSize="16" Margin="0,0,5,0"/>
                            <TextBlock Text="Düzenle" FontSize="13"/>
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding DeleteWordCommand}"
                            Height="38" Padding="15,0"
                            Background="#f44336" Foreground="White" FontWeight="SemiBold"
                            BorderThickness="0"
                            Style="{StaticResource RoundedButtonStyle}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="🗑️" FontSize="16" Margin="0,0,5,0"/>
                            <TextBlock Text="Sil" FontSize="13"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Word Cards -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding Words}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="White" CornerRadius="8" Padding="15" Margin="5" Cursor="Hand"
                                MouseLeftButtonUp="Border_MouseLeftButtonUp"
                                Tag="{Binding}">
                            <Border.BorderBrush>
                                <MultiBinding Converter="{StaticResource SelectedWordBorderConverter}">
                                    <Binding/>
                                    <Binding Path="DataContext.SelectedWord" RelativeSource="{RelativeSource AncestorType=UserControl}"/>
                                </MultiBinding>
                            </Border.BorderBrush>
                            <Border.BorderThickness>
                                <MultiBinding Converter="{StaticResource SelectedWordThicknessConverter}">
                                    <Binding/>
                                    <Binding Path="DataContext.SelectedWord" RelativeSource="{RelativeSource AncestorType=UserControl}"/>
                                </MultiBinding>
                            </Border.BorderThickness>
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Effect">
                                                <Setter.Value>
                                                    <DropShadowEffect Color="#2196F3" Opacity="0.3" BlurRadius="15" ShadowDepth="3"/>
                                                </Setter.Value>
                                            </Setter>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="15"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="15"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Left Side - Icon & Badge -->
                                <StackPanel Grid.Column="0" VerticalAlignment="Center" Width="50">
                                    <TextBlock Text="⭐" FontSize="28" HorizontalAlignment="Center"
                                               Visibility="{Binding IsFavorite, Converter={StaticResource BoolToVisibilityConverter}}"/>

                                    <Border Background="#4CAF50" CornerRadius="4" Padding="8,4" Margin="0,5,0,0"
                                            Visibility="{Binding IsNew, Converter={StaticResource BoolToVisibilityConverter}}"
                                            HorizontalAlignment="Center">
                                        <TextBlock Text="NEW" FontSize="10" FontWeight="Bold" Foreground="White"/>
                                    </Border>
                                </StackPanel>

                                <!-- Center - Word Info -->
                                <StackPanel Grid.Column="2" VerticalAlignment="Center">
                                    <!-- İngilizce Kelime -->
                                    <TextBlock Text="{Binding English}" FontSize="20" FontWeight="Bold" Foreground="#2c3e50"/>

                                    <!-- Anlamlar Listesi -->
                                    <ItemsControl ItemsSource="{Binding Meanings}" Margin="0,5,0,0">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <StackPanel Margin="0,3,0,0">
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock Text="•" FontSize="14" Foreground="#7f8c8d" Margin="0,0,5,0"/>
                                                        <TextBlock Text="{Binding Turkish}" FontSize="15" Foreground="#2c3e50" FontWeight="SemiBold"/>
                                                    </StackPanel>

                                                    <!-- Örnek Cümle -->
                                                    <TextBlock Text="{Binding ExampleSentence}" FontSize="12" Foreground="#95a5a6" 
                                                               FontStyle="Italic" Margin="15,2,0,0" TextWrapping="Wrap"
                                                               Visibility="{Binding ExampleSentence, Converter={StaticResource NullToVisibilityConverter}}"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                    <!-- Eski format için fallback (eğer Meanings boşsa) -->
                                    <StackPanel>
                                        <StackPanel.Style>
                                            <Style TargetType="StackPanel">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Meanings.Count}" Value="0">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </StackPanel.Style>

                                        <TextBlock Text="{Binding Turkish}" FontSize="15" Foreground="#2c3e50" FontWeight="SemiBold" Margin="0,5,0,0"/>
                                        <TextBlock Text="{Binding ExampleSentence}" FontSize="12" Foreground="#95a5a6" 
                                                   FontStyle="Italic" Margin="0,5,0,0" TextWrapping="Wrap"
                                                   Visibility="{Binding ExampleSentence, Converter={StaticResource NullToVisibilityConverter}}"/>
                                    </StackPanel>

                                    <!-- Kategori ve Seviye -->
                                    <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                        <Border Background="#e3f2fd" CornerRadius="3" Padding="8,4" Margin="0,0,8,0"
                                                Visibility="{Binding Category, Converter={StaticResource NullToVisibilityConverter}}">
                                            <TextBlock Text="{Binding Category}" FontSize="11" Foreground="#1976D2" FontWeight="SemiBold"/>
                                        </Border>

                                        <Border Background="#f3e5f5" CornerRadius="3" Padding="8,4">
                                            <TextBlock Text="{Binding DifficultyLevel}" FontSize="11" Foreground="#7B1FA2" FontWeight="SemiBold"/>
                                        </Border>
                                    </StackPanel>
                                </StackPanel>

                                <!-- Right Side - Stats -->
                                <StackPanel Grid.Column="4" VerticalAlignment="Center">
                                    <Border Background="#e8f5e9" CornerRadius="6" Padding="12,8" Margin="0,0,0,8">
                                        <StackPanel>
                                            <TextBlock Text="Test Sayısı" FontSize="11" Foreground="#66BB6A" HorizontalAlignment="Center"/>
                                            <TextBlock Text="{Binding ReviewCount}" FontSize="20" FontWeight="Bold" 
                                                       Foreground="#2E7D32" HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>

                                    <Border Background="#fff3e0" CornerRadius="6" Padding="12,8">
                                        <StackPanel>
                                            <TextBlock Text="Başarı Oranı" FontSize="11" Foreground="#FFA726" HorizontalAlignment="Center"/>
                                            <TextBlock FontSize="20" FontWeight="Bold" Foreground="#F57C00" HorizontalAlignment="Center">
                                                <TextBlock.Text>
                                                    <MultiBinding StringFormat="{}{0:N0}%">
                                                        <Binding Path="SuccessRate"/>
                                                    </MultiBinding>
                                                </TextBlock.Text>
                                            </TextBlock>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>